{% extends "base.html" %}

{% block title %}Market Dashboard{% endblock %}

{% block content %}
<div class="container-fluid">
  <div class="row mb-4">
    <!-- NIFTY 50 -->
    <div class="col-md-3">
      <div class="card market-card bg-primary text-white animate__animated animate__fadeInUp">
        <div class="card-body">
          <h5 class="card-title">NIFTY 50</h5>
          {% if market_data.NIFTY_50 %}
          <h2 class="card-text">
            {{ market_data.NIFTY_50['data'][0]['lastPrice'] }}
            <span class="badge bg-{{ 'success' if market_data.NIFTY_50['data'][0]['pChange'] > 0 else 'danger' }}">
              {{ market_data.NIFTY_50['data'][0]['pChange'] }}%
            </span>
          </h2>
          <p class="card-text"><small>Volume: {{ market_data.NIFTY_50['data'][0]['quantityTraded'] }}</small></p>
          {% else %}
          <h2 class="card-text">-- <span class="badge bg-secondary">--%</span></h2>
          <p class="card-text"><small>Data unavailable</small></p>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- BANK NIFTY -->
    <div class="col-md-3">
      <div class="card market-card bg-warning text-dark animate__animated animate__fadeInUp" style="animation-delay: 0.1s">
        <div class="card-body">
          <h5 class="card-title">BANK NIFTY</h5>
          {% if market_data.BANK_NIFTY %}
          <h2 class="card-text">
            {{ market_data.BANK_NIFTY['data'][0]['lastPrice'] }}
            <span class="badge bg-{{ 'success' if market_data.BANK_NIFTY['data'][0]['pChange'] > 0 else 'danger' }}">
              {{ market_data.BANK_NIFTY['data'][0]['pChange'] }}%
            </span>
          </h2>
          <p class="card-text"><small>Volume: {{ market_data.BANK_NIFTY['data'][0]['quantityTraded'] }}</small></p>
          {% else %}
          <h2 class="card-text">-- <span class="badge bg-secondary">--%</span></h2>
          <p class="card-text"><small>Data unavailable</small></p>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- NIFTY IT -->
    <div class="col-md-3">
      <div class="card market-card bg-success text-white animate__animated animate__fadeInUp" style="animation-delay: 0.2s">
        <div class="card-body">
          <h5 class="card-title">NIFTY IT</h5>
          {% if market_data.NIFTY_IT %}
          <h2 class="card-text">
            {{ market_data.NIFTY_IT['data'][0]['lastPrice'] }}
            <span class="badge bg-{{ 'success' if market_data.NIFTY_IT['data'][0]['pChange'] > 0 else 'danger' }}">
              {{ market_data.NIFTY_IT['data'][0]['pChange'] }}%
            </span>
          </h2>
          <p class="card-text"><small>Volume: {{ market_data.NIFTY_IT['data'][0]['quantityTraded'] }}</small></p>
          {% else %}
          <h2 class="card-text">-- <span class="badge bg-secondary">--%</span></h2>
          <p class="card-text"><small>Data unavailable</small></p>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Market Status -->
    <div class="col-md-3">
      <div class="card market-card bg-info text-white animate__animated animate__fadeInUp" style="animation-delay: 0.3s">
        <div class="card-body">
          <h5 class="card-title">Market Status</h5>
          <h2 class="card-text">Live</h2>
          <p class="card-text"><small>Updated: {{ last_updated }}</small></p>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row mt-4">
    <div class="col-12">
      <div class="card shadow-sm animate__animated animate__fadeInUp">
        <div class="card-header bg-dark text-white">
          <h5 class="mb-0">ðŸ“¢News Station - Get latest news regarding the stock market</h5>
        </div>
        <ul class="list-group list-group-flush">
          {% for article in news_articles %}
          <li class="list-group-item">
            <a href="{{ article.url }}" target="_blank">
              <strong>{{ article.title }}</strong>
            </a>
            <br>
            <small class="text-muted">{{ article.source.name }} | {{ article.publishedAt[:10] }}</small>
          </li>
          {% endfor %}
          {% if news_articles|length == 0 %}
          <li class="list-group-item text-muted">No news available at the moment.</li>
          {% endif %}
        </ul>
      </div>
    </div>
  </div>
  
{% endblock %}
